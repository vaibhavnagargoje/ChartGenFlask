

<!DOCTYPE html>
<html>
<head>
    <title>Excel Data Chart</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@400&display=swap" rel="stylesheet">
    <style>
        body { 
            font-family: Lato; 
            margin: 20px; 
            background-color: #f5f5f5;
        }
        .chart-container { 
            max-width: 1000px; 
            margin: 0 auto 20px auto; 
            background-color: white;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            padding: 20px;
            position: relative;
        }
        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .chart-title {
            font-size: 20px;
            font-weight: bold;
            color: #2c3e50;
            flex-grow: 1;
            text-align: center;
            margin-left: 90px;
        }
        .chart-logo {
            width: 90px;
            height: auto;
        }
        .chart-filter-controls {
            display: flex;
            align-items: center;
            padding: 8px 8px 0px 8px;
            border-radius: 4px;
        }
        .chart-filter-group {
            display: flex;
            align-items: center;
            margin-left:45px;
        }
        .chart-filter-group label {
            margin-right: 5px;
            font-size: 12px;
            color: black;
        }
        .chart-filter-group select {
            padding: 6px 5px;
            color:rgb(0, 0, 0);
            border: 1px solid #863F3F;
            font-size: 12px;
            min-width: 100px;
        }
        .chart-canvas-container {
            height: 500px;
            width: 100%;
        }
        .chart-footer {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            padding-top: 5px;
            border-top: 1px solid #e9ecef;
        }
        .chart-info {
            flex: 1;
        }
        .chart-description {
            margin-top: 0;
            padding: 2px;
            font-size: 10px;
            padding-left: 53px;
        }
        .chart-additional-info {
            margin-top: 2px;
            padding: 2px;
            font-size: 10px;
            padding-left: 53px;
        }
        .chart-actions {
            display: flex;
            align-items: flex-start;
            margin-left: 15px;
        }
        .chart-date {
            font-size: 12px;
            color: #6c757d;
        }
        .icon-btn {
            background: none;
            border: none;
            cursor: pointer;
            color: #6c757d;
            padding: 0;
            margin: 0;
            margin-top: 7px;
        }
        .icon-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>
    <div class="chart-container">
        <div class="chart-header">
            <div class="chart-title">Excel Data Chart</div>
            <img class="chart-logo" src="logo.png" alt="ChartFlask Logo">
        </div>
        
        <div class="chart-filter-controls">
            <div class="chart-filter-group">
                <label for="chartFilter">Taluka</label>
                <select id="chartFilter" onchange="filterChartData()">
                    <option value="">All</option>
                    <option value="Devgad" >Devgad</option><option value="Vaibhavwadi" >Vaibhavwadi</option><option value="Kankavali" >Kankavali</option><option value="Malvan" >Malvan</option><option value="Vengurla" >Vengurla</option><option value="Kudal" >Kudal</option><option value="Sawantwadi" >Sawantwadi</option><option value="Dodamarg" >Dodamarg</option><option value="Kankawali" >Kankawali</option><option value="Malwan" >Malwan</option><option value="Savantwadi" >Savantwadi</option>
                </select>
            </div>
        </div>
        
        <div class="chart-canvas-container">
            <canvas id="myChart"></canvas>
        </div>
        <div class="chart-footer">
            <div class="chart-info">
            <div class="chart-additional-info">this is comment</div>
                <span class="chart-description">Source: this is source</span>
            </div>
            <div class="chart-actions">
                <button id="downloadChartBtn" class="icon-btn" title="Download Chart">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>
                </button>
            </div>
        </div>
    </div>
    
    <script>
        // Indian number formatting function
        function formatIndianNumber(num) {
            if (num === null || num === undefined || isNaN(num)) return '';  // Return empty string for null values
            
            let isNegative = false;
            if (num < 0) {
                isNegative = true;
                num = Math.abs(num);
            }
            
            let formattedNumber;
            if (num < 1000) {
                formattedNumber = num.toString();
            } else {
                const parts = num.toString().split('.');
                let integerPart = parts[0];
                
                const lastThree = integerPart.substring(integerPart.length - 3);
                const remaining = integerPart.substring(0, integerPart.length - 3);
                
                let formattedRemaining = '';
                if (remaining) {
                    formattedRemaining = remaining.replace(/\B(?=(\d{2})+(?!\d))/g, ',');
                }
                
                formattedNumber = formattedRemaining ? formattedRemaining + ',' + lastThree : lastThree;
                
                if (parts.length > 1) {
                    formattedNumber += '.' + parts[1];
                }
            }
            
            return isNegative ? '-' + formattedNumber : formattedNumber;
        }

        // Store original chart data for filtering
        const originalChartData = {
  "datasets": [
    {
      "backgroundColor": "#1a4570",
      "borderColor": "#1a4570",
      "borderWidth": 1,
      "data": [
        null,
        110196,
        110196,
        124045,
        248935,
        272155,
        null,
        54348,
        64467,
        399407
      ],
      "fill": false,
      "label": "Non-Agriculture Loans",
      "pointHoverRadius": 3,
      "pointRadius": 0,
      "spanGaps": false,
      "tension": 0,
      "pointBackgroundColor": "#1a4570"
    },
    {
      "backgroundColor": "#ee8939",
      "borderColor": "#ee8939",
      "borderWidth": 1,
      "data": [
        null,
        366596,
        366596,
        403048,
        624587,
        708101,
        null,
        870585,
        882431,
        985227
      ],
      "fill": false,
      "label": "Deposits",
      "pointHoverRadius": 3,
      "pointRadius": 0,
      "spanGaps": false,
      "tension": 0,
      "pointBackgroundColor": "#ee8939"
    },
    {
      "backgroundColor": "#f5b843",
      "borderColor": "#f5b843",
      "borderWidth": 1,
      "data": [
        0,
        153301,
        153301,
        172567,
        298831,
        328116,
        0,
        92601,
        105973,
        492363
      ],
      "fill": false,
      "label": "Total Loan",
      "pointHoverRadius": 3,
      "pointRadius": 0,
      "spanGaps": false,
      "tension": 0,
      "pointBackgroundColor": "#f5b843"
    }
  ],
  "labels": [
    2012,
    2013,
    2014,
    2015,
    2016,
    2017,
    2018,
    2019,
    2020,
    2021
  ]
};
        
        // Pre-filtered data for each district
        const preFilteredData = {
  "Devgad": {
    "datasets": [
      {
        "backgroundColor": "#1a4570",
        "borderColor": "#1a4570",
        "borderWidth": 1,
        "data": [
          null,
          13566,
          13566,
          15566,
          11245,
          12247,
          null,
          7596,
          9434,
          20856
        ],
        "fill": false,
        "label": "Non-Agriculture Loans",
        "pointHoverRadius": 3,
        "pointRadius": 0,
        "spanGaps": false,
        "tension": 0
      },
      {
        "backgroundColor": "#ee8939",
        "borderColor": "#ee8939",
        "borderWidth": 1,
        "data": [
          null,
          45152,
          45152,
          49852,
          83250,
          92053,
          null,
          132546,
          129136,
          84666
        ],
        "fill": false,
        "label": "Deposits",
        "pointHoverRadius": 3,
        "pointRadius": 0,
        "spanGaps": false,
        "tension": 0
      },
      {
        "backgroundColor": "#f5b843",
        "borderColor": "#f5b843",
        "borderWidth": 1,
        "data": [
          0,
          18870,
          18870,
          21470,
          20394,
          22320,
          0,
          13560,
          15508,
          39570
        ],
        "fill": false,
        "label": "Total Loan",
        "pointHoverRadius": 3,
        "pointRadius": 0,
        "spanGaps": false,
        "tension": 0
      }
    ],
    "labels": [
      2012,
      2013,
      2014,
      2015,
      2016,
      2017,
      2018,
      2019,
      2020,
      2021
    ]
  },
  "Malvan": {
    "datasets": [
      {
        "backgroundColor": "#1a4570",
        "borderColor": "#1a4570",
        "borderWidth": 1,
        "data": [
          null,
          13814,
          13814,
          15714,
          94186,
          100697,
          null
        ],
        "fill": false,
        "label": "Non-Agriculture Loans",
        "pointHoverRadius": 3,
        "pointRadius": 0,
        "spanGaps": false,
        "tension": 0
      },
      {
        "backgroundColor": "#ee8939",
        "borderColor": "#ee8939",
        "borderWidth": 1,
        "data": [
          null,
          45243,
          45243,
          50913,
          58916,
          63729,
          null
        ],
        "fill": false,
        "label": "Deposits",
        "pointHoverRadius": 3,
        "pointRadius": 0,
        "spanGaps": false,
        "tension": 0
      },
      {
        "backgroundColor": "#f5b843",
        "borderColor": "#f5b843",
        "borderWidth": 1,
        "data": [
          0,
          19231,
          19231,
          21831,
          100065,
          107412,
          0
        ],
        "fill": false,
        "label": "Total Loan",
        "pointHoverRadius": 3,
        "pointRadius": 0,
        "spanGaps": false,
        "tension": 0
      }
    ],
    "labels": [
      2012,
      2013,
      2014,
      2015,
      2016,
      2017,
      2018
    ]
  },
  "Vaibhavwadi": {
    "datasets": [
      {
        "backgroundColor": "#1a4570",
        "borderColor": "#1a4570",
        "borderWidth": 1,
        "data": [
          null,
          3984,
          3984,
          5984,
          5311,
          5851,
          null,
          2577,
          3369,
          8081
        ],
        "fill": false,
        "label": "Non-Agriculture Loans",
        "pointHoverRadius": 3,
        "pointRadius": 0,
        "spanGaps": false,
        "tension": 0
      },
      {
        "backgroundColor": "#ee8939",
        "borderColor": "#ee8939",
        "borderWidth": 1,
        "data": [
          null,
          13275,
          13275,
          16875,
          22889,
          28324,
          null,
          45183,
          46120,
          25790
        ],
        "fill": false,
        "label": "Deposits",
        "pointHoverRadius": 3,
        "pointRadius": 0,
        "spanGaps": false,
        "tension": 0
      },
      {
        "backgroundColor": "#f5b843",
        "borderColor": "#f5b843",
        "borderWidth": 1,
        "data": [
          0,
          5459,
          5459,
          7959,
          8207,
          9209,
          0,
          4302,
          5538,
          10152
        ],
        "fill": false,
        "label": "Total Loan",
        "pointHoverRadius": 3,
        "pointRadius": 0,
        "spanGaps": false,
        "tension": 0
      }
    ],
    "labels": [
      2012,
      2013,
      2014,
      2015,
      2016,
      2017,
      2018,
      2019,
      2020,
      2021
    ]
  },
  "Kankavali": {
    "datasets": [
      {
        "backgroundColor": "#1a4570",
        "borderColor": "#1a4570",
        "borderWidth": 1,
        "data": [
          null,
          18291,
          18291,
          20291,
          20646,
          25175,
          null
        ],
        "fill": false,
        "label": "Non-Agriculture Loans",
        "pointHoverRadius": 3,
        "pointRadius": 0,
        "spanGaps": false,
        "tension": 0
      },
      {
        "backgroundColor": "#ee8939",
        "borderColor": "#ee8939",
        "borderWidth": 1,
        "data": [
          null,
          61123,
          61123,
          68123,
          91243,
          106215,
          null
        ],
        "fill": false,
        "label": "Deposits",
        "pointHoverRadius": 3,
        "pointRadius": 0,
        "spanGaps": false,
        "tension": 0
      },
      {
        "backgroundColor": "#f5b843",
        "borderColor": "#f5b843",
        "borderWidth": 1,
        "data": [
          0,
          25467,
          25467,
          28467,
          23035,
          27973,
          0
        ],
        "fill": false,
        "label": "Total Loan",
        "pointHoverRadius": 3,
        "pointRadius": 0,
        "spanGaps": false,
        "tension": 0
      }
    ],
    "labels": [
      2012,
      2013,
      2014,
      2015,
      2016,
      2017,
      2018
    ]
  },
  "Kudal": {
    "datasets": [
      {
        "backgroundColor": "#1a4570",
        "borderColor": "#1a4570",
        "borderWidth": 1,
        "data": [
          null,
          24739,
          24739,
          25718,
          24156,
          26399,
          null,
          10081,
          13028,
          168847
        ],
        "fill": false,
        "label": "Non-Agriculture Loans",
        "pointHoverRadius": 3,
        "pointRadius": 0,
        "spanGaps": false,
        "tension": 0
      },
      {
        "backgroundColor": "#ee8939",
        "borderColor": "#ee8939",
        "borderWidth": 1,
        "data": [
          null,
          82216,
          82216,
          87206,
          142098,
          162863,
          null,
          81312,
          178332,
          275774
        ],
        "fill": false,
        "label": "Deposits",
        "pointHoverRadius": 3,
        "pointRadius": 0,
        "spanGaps": false,
        "tension": 0
      },
      {
        "backgroundColor": "#f5b843",
        "borderColor": "#f5b843",
        "borderWidth": 1,
        "data": [
          0,
          34323,
          34323,
          35712,
          35612,
          39270,
          0,
          14164,
          21416,
          184575
        ],
        "fill": false,
        "label": "Total Loan",
        "pointHoverRadius": 3,
        "pointRadius": 0,
        "spanGaps": false,
        "tension": 0
      }
    ],
    "labels": [
      2012,
      2013,
      2014,
      2015,
      2016,
      2017,
      2018,
      2019,
      2020,
      2021
    ]
  },
  "Vengurla": {
    "datasets": [
      {
        "backgroundColor": "#1a4570",
        "borderColor": "#1a4570",
        "borderWidth": 1,
        "data": [
          null,
          11757,
          11757,
          13727,
          77415,
          84368,
          null,
          8795,
          6065,
          22381
        ],
        "fill": false,
        "label": "Non-Agriculture Loans",
        "pointHoverRadius": 3,
        "pointRadius": 0,
        "spanGaps": false,
        "tension": 0
      },
      {
        "backgroundColor": "#ee8939",
        "borderColor": "#ee8939",
        "borderWidth": 1,
        "data": [
          null,
          40263,
          40263,
          43633,
          69743,
          70810,
          null,
          174117,
          83016,
          86637
        ],
        "fill": false,
        "label": "Deposits",
        "pointHoverRadius": 3,
        "pointRadius": 0,
        "spanGaps": false,
        "tension": 0
      },
      {
        "backgroundColor": "#f5b843",
        "borderColor": "#f5b843",
        "borderWidth": 1,
        "data": [
          0,
          16437,
          16437,
          19107,
          82557,
          89989,
          0,
          16251,
          9970,
          33168
        ],
        "fill": false,
        "label": "Total Loan",
        "pointHoverRadius": 3,
        "pointRadius": 0,
        "spanGaps": false,
        "tension": 0
      }
    ],
    "labels": [
      2012,
      2013,
      2014,
      2015,
      2016,
      2017,
      2018,
      2019,
      2020,
      2021
    ]
  },
  "Sawantwadi": {
    "datasets": [
      {
        "backgroundColor": "#1a4570",
        "borderColor": "#1a4570",
        "borderWidth": 1,
        "data": [
          null,
          18358,
          18358,
          20358,
          11518,
          12519,
          null
        ],
        "fill": false,
        "label": "Non-Agriculture Loans",
        "pointHoverRadius": 3,
        "pointRadius": 0,
        "spanGaps": false,
        "tension": 0
      },
      {
        "backgroundColor": "#ee8939",
        "borderColor": "#ee8939",
        "borderWidth": 1,
        "data": [
          null,
          61078,
          61078,
          65218,
          114219,
          134540,
          null
        ],
        "fill": false,
        "label": "Deposits",
        "pointHoverRadius": 3,
        "pointRadius": 0,
        "spanGaps": false,
        "tension": 0
      },
      {
        "backgroundColor": "#f5b843",
        "borderColor": "#f5b843",
        "borderWidth": 1,
        "data": [
          0,
          25643,
          25643,
          28343,
          19577,
          21473,
          0
        ],
        "fill": false,
        "label": "Total Loan",
        "pointHoverRadius": 3,
        "pointRadius": 0,
        "spanGaps": false,
        "tension": 0
      }
    ],
    "labels": [
      2012,
      2013,
      2014,
      2015,
      2016,
      2017,
      2018
    ]
  },
  "Kankawali": {
    "datasets": [
      {
        "backgroundColor": "#1a4570",
        "borderColor": "#1a4570",
        "borderWidth": 1,
        "data": [
          7647,
          10782,
          71097
        ],
        "fill": false,
        "label": "Non-Agriculture Loans",
        "pointHoverRadius": 3,
        "pointRadius": 0,
        "spanGaps": false,
        "tension": 0
      },
      {
        "backgroundColor": "#ee8939",
        "borderColor": "#ee8939",
        "borderWidth": 1,
        "data": [
          144517,
          147584,
          160439
        ],
        "fill": false,
        "label": "Deposits",
        "pointHoverRadius": 3,
        "pointRadius": 0,
        "spanGaps": false,
        "tension": 0
      },
      {
        "backgroundColor": "#f5b843",
        "borderColor": "#f5b843",
        "borderWidth": 1,
        "data": [
          14052,
          17724,
          85735
        ],
        "fill": false,
        "label": "Total Loan",
        "pointHoverRadius": 3,
        "pointRadius": 0,
        "spanGaps": false,
        "tension": 0
      }
    ],
    "labels": [
      2019,
      2020,
      2021
    ]
  },
  "Dodamarg": {
    "datasets": [
      {
        "backgroundColor": "#1a4570",
        "borderColor": "#1a4570",
        "borderWidth": 1,
        "data": [
          null,
          5687,
          5687,
          6687,
          4458,
          4899,
          null,
          2056,
          2696,
          8508
        ],
        "fill": false,
        "label": "Non-Agriculture Loans",
        "pointHoverRadius": 3,
        "pointRadius": 0,
        "spanGaps": false,
        "tension": 0
      },
      {
        "backgroundColor": "#ee8939",
        "borderColor": "#ee8939",
        "borderWidth": 1,
        "data": [
          null,
          18246,
          18246,
          21228,
          42229,
          49567,
          null,
          36959,
          36896,
          40121
        ],
        "fill": false,
        "label": "Deposits",
        "pointHoverRadius": 3,
        "pointRadius": 0,
        "spanGaps": false,
        "tension": 0
      },
      {
        "backgroundColor": "#f5b843",
        "borderColor": "#f5b843",
        "borderWidth": 1,
        "data": [
          0,
          7871,
          7871,
          9678,
          9384,
          10470,
          0,
          3526,
          4431,
          11766
        ],
        "fill": false,
        "label": "Total Loan",
        "pointHoverRadius": 3,
        "pointRadius": 0,
        "spanGaps": false,
        "tension": 0
      }
    ],
    "labels": [
      2012,
      2013,
      2014,
      2015,
      2016,
      2017,
      2018,
      2019,
      2020,
      2021
    ]
  },
  "Malwan": {
    "datasets": [
      {
        "backgroundColor": "#1a4570",
        "borderColor": "#1a4570",
        "borderWidth": 1,
        "data": [
          7071,
          8760,
          33986
        ],
        "fill": false,
        "label": "Non-Agriculture Loans",
        "pointHoverRadius": 3,
        "pointRadius": 0,
        "spanGaps": false,
        "tension": 0
      },
      {
        "backgroundColor": "#ee8939",
        "borderColor": "#ee8939",
        "borderWidth": 1,
        "data": [
          117441,
          119912,
          100268
        ],
        "fill": false,
        "label": "Deposits",
        "pointHoverRadius": 3,
        "pointRadius": 0,
        "spanGaps": false,
        "tension": 0
      },
      {
        "backgroundColor": "#f5b843",
        "borderColor": "#f5b843",
        "borderWidth": 1,
        "data": [
          11896,
          14400,
          43158
        ],
        "fill": false,
        "label": "Total Loan",
        "pointHoverRadius": 3,
        "pointRadius": 0,
        "spanGaps": false,
        "tension": 0
      }
    ],
    "labels": [
      2019,
      2020,
      2021
    ]
  },
  "Savantwadi": {
    "datasets": [
      {
        "backgroundColor": "#1a4570",
        "borderColor": "#1a4570",
        "borderWidth": 1,
        "data": [
          8525,
          10333,
          65651
        ],
        "fill": false,
        "label": "Non-Agriculture Loans",
        "pointHoverRadius": 3,
        "pointRadius": 0,
        "spanGaps": false,
        "tension": 0
      },
      {
        "backgroundColor": "#ee8939",
        "borderColor": "#ee8939",
        "borderWidth": 1,
        "data": [
          138510,
          141435,
          211532
        ],
        "fill": false,
        "label": "Deposits",
        "pointHoverRadius": 3,
        "pointRadius": 0,
        "spanGaps": false,
        "tension": 0
      },
      {
        "backgroundColor": "#f5b843",
        "borderColor": "#f5b843",
        "borderWidth": 1,
        "data": [
          14850,
          16986,
          84239
        ],
        "fill": false,
        "label": "Total Loan",
        "pointHoverRadius": 3,
        "pointRadius": 0,
        "spanGaps": false,
        "tension": 0
      }
    ],
    "labels": [
      2019,
      2020,
      2021
    ]
  }
};

        // Chart configuration
        const ctx = document.getElementById('myChart').getContext('2d');
        const chartData = {
  "datasets": [
    {
      "backgroundColor": "#1a4570",
      "borderColor": "#1a4570",
      "borderWidth": 1,
      "data": [
        null,
        110196,
        110196,
        124045,
        248935,
        272155,
        null,
        54348,
        64467,
        399407
      ],
      "fill": false,
      "label": "Non-Agriculture Loans",
      "pointHoverRadius": 3,
      "pointRadius": 0,
      "spanGaps": false,
      "tension": 0,
      "pointBackgroundColor": "#1a4570"
    },
    {
      "backgroundColor": "#ee8939",
      "borderColor": "#ee8939",
      "borderWidth": 1,
      "data": [
        null,
        366596,
        366596,
        403048,
        624587,
        708101,
        null,
        870585,
        882431,
        985227
      ],
      "fill": false,
      "label": "Deposits",
      "pointHoverRadius": 3,
      "pointRadius": 0,
      "spanGaps": false,
      "tension": 0,
      "pointBackgroundColor": "#ee8939"
    },
    {
      "backgroundColor": "#f5b843",
      "borderColor": "#f5b843",
      "borderWidth": 1,
      "data": [
        0,
        153301,
        153301,
        172567,
        298831,
        328116,
        0,
        92601,
        105973,
        492363
      ],
      "fill": false,
      "label": "Total Loan",
      "pointHoverRadius": 3,
      "pointRadius": 0,
      "spanGaps": false,
      "tension": 0,
      "pointBackgroundColor": "#f5b843"
    }
  ],
  "labels": [
    2012,
    2013,
    2014,
    2015,
    2016,
    2017,
    2018,
    2019,
    2020,
    2021
  ]
};
        const chartOptions = {
  "responsive": true,
  "maintainAspectRatio": false,
  "animation": {
    "duration": 750,
    "easing": "easeInOutQuart"
  },
  "plugins": {
    "legend": {
      "display": false
    },
    "title": {
      "text": "Excel Data Chart",
      "display": true
    }
  },
  "scales": {
    "x": {
      "axis": "x",
      "grid": {
        "display": false,
        "drawBorder": true,
        "lineWidth": 1,
        "drawOnChartArea": true,
        "drawTicks": true,
        "tickLength": 8,
        "offset": false,
        "color": "rgba(0,0,0,0.1)"
      },
      "type": "category",
      "ticks": {
        "minRotation": 0,
        "maxRotation": 50,
        "mirror": false,
        "textStrokeWidth": 0,
        "textStrokeColor": "",
        "padding": 3,
        "display": true,
        "autoSkip": true,
        "autoSkipPadding": 3,
        "labelOffset": 0,
        "minor": {},
        "major": {},
        "align": "center",
        "crossAlign": "near",
        "showLabelBackdrop": false,
        "backdropColor": "rgba(255, 255, 255, 0.75)",
        "backdropPadding": 2,
        "color": "#666"
      },
      "display": true,
      "offset": false,
      "reverse": false,
      "beginAtZero": false,
      "bounds": "ticks",
      "clip": true,
      "grace": 0,
      "border": {
        "display": true,
        "dash": [],
        "dashOffset": 0,
        "width": 1,
        "color": "rgba(0,0,0,0.1)"
      },
      "title": {
        "display": true,
        "text": "revenue and expenditure",
        "padding": {
          "top": 4,
          "bottom": 4
        },
        "color": "#666"
      },
      "id": "x",
      "position": "bottom"
    },
    "y": {
      "axis": "y",
      "grid": {
        "drawBorder": false,
        "display": true,
        "lineWidth": 1,
        "drawOnChartArea": true,
        "drawTicks": true,
        "tickLength": 8,
        "offset": false,
        "color": "rgba(0,0,0,0.1)"
      },
      "ticks": {
        "maxTicksLimit": 6,
        "color": "#333",
        "minRotation": 0,
        "maxRotation": 50,
        "mirror": false,
        "textStrokeWidth": 0,
        "textStrokeColor": "",
        "padding": 3,
        "display": true,
        "autoSkip": true,
        "autoSkipPadding": 3,
        "labelOffset": 0,
        "minor": {},
        "major": {},
        "align": "center",
        "crossAlign": "near",
        "showLabelBackdrop": false,
        "backdropColor": "rgba(255, 255, 255, 0.75)",
        "backdropPadding": 2
      },
      "type": "linear",
      "display": true,
      "offset": false,
      "reverse": false,
      "beginAtZero": false,
      "bounds": "ticks",
      "clip": true,
      "grace": 0,
      "border": {
        "display": true,
        "dash": [],
        "dashOffset": 0,
        "width": 1,
        "color": "rgba(0,0,0,0.1)"
      },
      "title": {
        "display": true,
        "text": "Percentage",
        "padding": {
          "top": 4,
          "bottom": 4
        },
        "color": "#666"
      },
      "id": "y",
      "position": "left"
    }
  },
  "spanGaps": false
};

const hasMin = chartOptions?.scales?.y?.min !== undefined;




const chart = new Chart(ctx, {
    type: 'line',
    data: chartData,
    options: {
        ...chartOptions,
        interaction: {
            mode: 'index',
            intersect: false
        },
        plugins: {
            ...chartOptions?.plugins,
            title: {
                display: false
            },
            tooltip: {
                backgroundColor: 'white',
                titleColor: 'black',
                bodyColor: 'black',
                animation: {
                    duration: 50,
                    easing: 'easeOutQuart'
                },
                callbacks: {
                    label: function(context) {
                        let label = context.dataset.label || '';
                        if (label) {
                            label += ': ';
                        }
                        
                        if (context.parsed.y !== null && context.parsed.y !== undefined) {
                            label += formatIndianNumber(context.parsed.y);
                        } else {
                            label += 'No data';
                        }
                        return label;
                    }
                }
            },
            legend: {
                display: true,
                labels: {
                    boxWidth: 20,
                    boxHeight: 20,
                    usePointStyle: true,
                    pointStyle: 'rect',
                    padding: 15,
                    color: '#333',
                    font: {
                        size: 12,
                    }
                }
            }
        },
        scales: {
            ...chartOptions?.scales,
            x: {
                ...chartOptions?.scales?.x,
                offset: true,
                grid: {
                    drawTicks: true,
                    drawOnChartArea: false,
                },
                ticks: {
                    color: '#333',                    
                }
            },
            y: {
                min: 0,
                ...chartOptions?.scales?.y,
                offset: hasMin,
                grid: {
                    color: 'rgba(0,0,0,0.06)',
                    drawBorder: false
                },
                ticks: {
                    callback: function(value) {
                        // Only show whole numbers
                        return Number.isInteger(value) ? formatIndianNumber(value) : '';
                    },

                    
                    color: '#333',
                    
                   
                    precision: 0,  // No decimals
                    maxTicksLimit: 7,  // Maximum 7 ticks
                   
                }
            }
        },
        spanGaps: false
    }
});

// Rest of your original code (filterChartData, displayFilterMessage functions) remains the same
// Rest of your code (filterChartData, displayFilterMessage functions remain the same)
        
        // Function to filter chart data based on selected value
        function filterChartData() {
            const filterValue = document.getElementById('chartFilter').value;
            
            if (!chart || !chart.data) return;
            
            try {
                // Store current dataset visibility
                const visibility = [];
                chart.data.datasets.forEach((dataset, index) => {
                    visibility.push(!chart.getDatasetMeta(index).hidden);
                });
                
                // Handle the "All Values" option
                if (!filterValue) {
                    // Reset to full data
                    chart.data.labels = originalChartData.labels;
                    chart.data.datasets.forEach((dataset, i) => {
                        dataset.data = originalChartData.datasets[i].data;
                    });
                // Use pre-filtered data if available
                } else if (preFilteredData && preFilteredData[filterValue]) {
                    // Use pre-filtered data from the server
                    const filteredData = preFilteredData[filterValue];
                    
                    // Check if we have valid data
                    if (filteredData && filteredData.labels && filteredData.datasets) {
                        // Update labels and datasets
                        chart.data.labels = filteredData.labels;
                        
                        // Update each dataset's data while preserving other properties
                        filteredData.datasets.forEach((dataset, i) => {
                            if (i < chart.data.datasets.length) {
                                chart.data.datasets[i].data = dataset.data;
                            }
                        });
                    }
                } else {
                    // Fallback to client-side filtering if no pre-filtered data is available
                    console.log("No pre-filtered data available for " + filterValue + ", using fallback filter");
                    
                    // Try exact match in x-axis labels (categorical data)
                    const matchingIndices = [];
                    originalChartData.labels.forEach((label, i) => {
                        if (String(label).toLowerCase() === String(filterValue).toLowerCase()) {
                            matchingIndices.push(i);
                        }
                    });
                    
                    if (matchingIndices.length > 0) {
                        // Filter data to only show matching categories
                        chart.data.labels = matchingIndices.map(i => originalChartData.labels[i]);
                        chart.data.datasets.forEach((dataset, i) => {
                            dataset.data = matchingIndices.map(i => originalChartData.datasets[i].data[i]);
                        });
                    } else {
                        // No exact matches found, show message
                        displayFilterMessage(filterValue);
                    }
                }
                
                // Restore dataset visibility that wasn't specifically changed
                chart.data.datasets.forEach((dataset, index) => {
                    if (chart.getDatasetMeta(index).hidden === undefined) {
                        chart.getDatasetMeta(index).hidden = !visibility[index];
                    }
                });
                
                // Update the chart
                chart.update();
            } catch (error) {
                console.error("Error filtering chart:", error);
                // Show error message and reset to full data
                displayFilterMessage(filterValue, true);
                
                // Reset to full data
                chart.data.labels = originalChartData.labels;
                chart.data.datasets.forEach((dataset, i) => {
                    dataset.data = originalChartData.datasets[i].data;
                });
                chart.update();
            }
        }
        
        // Helper function to display filter messages
        function displayFilterMessage(filterValue, isError = false) {
            const messageDiv = document.createElement('div');
            
            if (isError) {
                messageDiv.style.cssText = 'padding: 10px; margin: 10px 0; background-color: #f8d7da; color: #721c24; border-radius: 4px; border-left: 4px solid #f5c6cb;';
                messageDiv.innerHTML = '<strong>Error:</strong> Could not filter data for "' + filterValue + 
                    '". Showing all values.';
            } else {
                messageDiv.style.cssText = 'padding: 10px; margin: 10px 0; background-color: #cfe8ff; color: #084298; border-radius: 4px; border-left: 4px solid #084298;';
                messageDiv.innerHTML = '<strong>Note:</strong> No filter data available for "' + filterValue + 
                    '". Showing all values.';
            }
            
            messageDiv.className = 'filter-message';
            
            const chartContainer = document.querySelector('.chart-container');
            const existingMessage = chartContainer.querySelector('.filter-message');
            if (existingMessage) {
                chartContainer.removeChild(existingMessage);
            }
            
            const canvasContainer = document.querySelector('.chart-canvas-container');
            chartContainer.insertBefore(messageDiv, canvasContainer);
            
            // Auto-remove after 4 seconds
            setTimeout(() => {
                if (messageDiv.parentNode) {
                    messageDiv.parentNode.removeChild(messageDiv);
                }
            }, 4000);
        }
        

        // Add download functionality
        document.getElementById('downloadChartBtn').addEventListener('click', function() {
            const canvas = document.getElementById('myChart');
            const image = canvas.toDataURL('image/png');
            const link = document.createElement('a');
            link.download = 'Excel Data Chart.png';
            link.href = image;
            link.click();
        });
        
        // Apply the initial filter value if one is selected
        
    </script>
</body>
</html>